<!DOCTYPE html>
<html>
  <head>
    <title>Twittler</title>
    <script src="jquery.js"></script>
    <!--script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script-->
    <script src="moment.js" type="text/javascript"></script>
    <script src="data_generator.js"></script>
    <!--script src="jquery.timeago.js"></script-->
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>

  <h1 class="title">Twittler</h1>
  <div class="home"></div>

    <script>

      $(document).ready(function(){

        var lastIndex = 0;
        //$("abbr.timeago").timeago();
        var update = function(){


          console.log(streams.home.length);
          var $body = $('.home');
          //$body.html('');
          //console.log(lastIndex);
          var index = streams.home.length - 1;
          var i = 0;
          while(index >= lastIndex){
            var tweet = streams.home[index];
            var date = tweet.created_at;
            //console.log(date);
            //date.setHours(date.getHours() - date.getTimezoneOffset() / 60);
            var $tweet = $("<div class='message'></div>");

            $tweet.text(' @' + tweet.user + ': ' + tweet.message);
            $tweet.prependTo($body);

            $tweet = $('<p class="sent"></p>');
            $tweet.text('sent ' + moment(date).fromNow());
            //console.log(moment(date).fromNow());
            //$tweet.attr('title','Title');

            $tweet.appendTo($('.message').first());


            index--;
            i++;

          }
          lastIndex = lastIndex + i;
        };

        setInterval(update,3000);

        update();

      });

    </script>
  </body>
</html>
