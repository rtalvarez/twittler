<!DOCTYPE html>
<html>
  <head>
    <title>Twittler</title>
    <!--script src="jquery.js"></script-->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <!--script src="moment.js" type="text/javascript"></script-->
    <script src="data_generator.js"></script>
    <script src="jquery.timeago.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>

  <h1 class="title">Twittler (@cilop)</h1>
  <h2 class="update"> - update tweets ! - </h2>
  <div class="home"></div>

    <script>


      $(document).ready(function(){

        $('abbr.timeago').timeago();



        //setInterval(update,3000);
        
        //});

        console.log('this is out of ready handler');

        var lastIndex = 0;
        
        var update = function(){

          var $body = $('.home');
          var index = streams.home.length - 1;
          var i = 0;
          

          while(index >= lastIndex){
            var tweet = streams.home[index];
            var date = tweet.created_at.toISOString();
            //console.log(date);
            //date.setHours(date.getHours() - date.getTimezoneOffset() / 60);
            var $tweet = $("<div class='message' data-user='" + tweet.user + "''></div>");

            $tweet.text(' @' + tweet.user + ': ' + tweet.message);
            $tweet.prependTo($body);

            $tweet = $('<p class="sent"> sent <abbr class="timeago" title="' + date + '">this should be updated...</abbr></p>');
            //$tweet.text('sent timeago');
            //console.log(moment(date).fromNow());
            //$tweet.attr('title','Title');

            $tweet.appendTo($('.message').first());


            index--;
            i++;

          }
          lastIndex = lastIndex + i;
        };

        //setInterval(update,3000);

        update();




        

        var hidden;
        $('.message').on('click',function(event){

          event.preventDefault();
          var user = $(this).data('user');
          

          if (!hidden){
            //$('.title').text('Twittler (@' + user +')');
            $('.title').fadeOut(500, function(){

              $(this).text('Twittler (@' + user + ')').fadeIn(500);
            });

            $('.message').filter(function(){

              hidden = true;
              return $(this).data('user') !== user;

            }).fadeOut(600);
          }else{
            //$('.title').text('Twittler (@cilop)');
            $('.title').fadeOut(500, function(){

              $(this).text('Twittler (@cilop)').fadeIn(500);
            });
            $('.message').filter(function(){

              hidden = false;
              return $(this).data('user') !== user;
            }).fadeIn(600);
          }

          //console.log($test);
          //$(this).toggleClass('removed');
        });


        $('.update').on('click',update);


        $('.message').on('mouseenter',function(event){

          event.preventDefault();
          $(this).addClass('highlighted');
          //$(this).stop().animate({
                //8ed6ff
            //   backgroundColor: 'blue',
               //'border-color': '1px solid #967',
               //'font-style': 'bold',
               //'text-decoration': 'underline'

           //},{duration:500});

        });

        $('.message').on('mouseleave',function(event){

          event.preventDefault();
          $(this).removeClass('highlighted');

        });

      });

    </script>
  </body>
</html>
